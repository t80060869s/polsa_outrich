# Email Domain Validator

Высокопроизводительный асинхронный инструмент для проверки валидности email-доменов (наличие MX-записей). Поддерживает работу через CLI (файлы) и REST API.

## Ключевые особенности

* **Асинхронность (asyncio):** Быстрая проверка тысяч адресов без блокировки потока.
* **Умное кэширование:** Результаты DNS-запросов кэшируются. Если в списке 1000 адресов на `gmail.com`, будет выполнен только **один** реальный запрос к DNS.
* **Поддержка IDNA:** Корректная работа с кириллическими доменами (например, `почта@торги-россии.рф`) благодаря автоматическому кодированию в Punycode.
* **Rate Limiting:** Семафор ограничивает количество одновременных DNS-запросов (по умолчанию 50), чтобы избежать бана со стороны провайдера.
* **Unicode-friendly:** API возвращает честный UTF-8 JSON (читаемая кириллица) и использует оптимизированный Regex.

## Установка

Требуется Python 3.8+.

Установите зависимости:

```bash
pip install -r requirements.txt
```

## Использование: CLI (Файловый режим)

Принимает текстовый файл (один email на строку).

**Запуск:**

```bash
python email_checker.py cli input.txt -o result.txt
```

* `input.txt` — путь к входному файлу.
* `-o result.txt` — (опционально) путь для сохранения результатов.

**Пример вывода:**

```text
test@gmail.com: домен валиден
fake@not-exists.com: домен отсутствует
info@торги-россии.рф: домен валиден
```

## Использование: REST API

Запускает веб-сервер для обработки JSON-запросов.

**Запуск сервера:**

```bash
python email_checker.py api --port 8080
```

**Пример запроса (в соседнем терминале):**

```bash
curl -X POST http://localhost:8080/check \
  -H "Content-Type: application/json" \
  -d '["test@gmail.com", "admin@россия.рф", "bad@domain.com"]'
```

**Ответ (JSON UTF-8):**

```json
{
  "test@gmail.com": "домен валиден",
  "admin@россия.рф": "MX-записи отсутствуют или некорректны",
  "bad@domain.com": "домен отсутствует"
}
```

## Технические нюансы

1. **Валидация формата:** Используется "мягкая" регулярка (`^[^@\s]+@[^@\s]+\.[^@\s]+$`). Мы намеренно не следуем строгому RFC 5322 для Regex, чтобы пропускать Unicode-символы и делегировать проверку существования домена DNS-ресолверу.
2. **Обработка ошибок DNS:** Скрипт различает `NXDOMAIN` (домена нет в принципе) и `NoAnswer/Timeout` (домен есть, но почту не принимает).
3. **JSON Response:** В API отключено экранирование ASCII (`ensure_ascii=False`), что уменьшает размер пейлоуда и делает ответ читаемым для человека.
