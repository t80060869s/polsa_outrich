# Telegram File Sender

Скрипт для асинхронной отправки содержимого текстовых файлов в Telegram-чат. Реализует автоматическое переключение между режимами отправки (текст/файл), определяет кодировку исходных данных и защищает систему от переполнения памяти.

## Возможности

* **Умная разбивка текста:** Автоматически делит длинные сообщения на части до 4096 символов, сохраняя целостность строк и слов.
* **Автодетект кодировки:** Встроенный анализ бинарных данных (`chardet`) позволяет корректно читать файлы в `UTF-8`, `CP1251`, `Windows-1252` и других кодировках без ручной конвертации.
* **Адаптивный режим отправки:**
  * Файлы до 20 000 символов отправляются как текст (с пагинацией).
  * Файлы свыше 20 000 символов отправляются как документ.
* **Защита ресурсов:** Предварительная проверка размера файла (Fail Fast) предотвращает чтение в память объектов, превышающих лимиты Telegram.
* **Обработка Rate Limits:** Встроенная защита от ошибки `429 Too Many Requests`.

## Требования

* Python 3.10 или выше.
* Доступ в интернет (HTTPS к `api.telegram.org`).

## Установка

1. Клонируйте репозиторий или скопируйте скрипт в рабочую директорию.
2. Создайте виртуальное окружение (рекомендуется):

    ```bash
    python -m venv venv
    source venv/bin/activate  # Linux/macOS
    venv\Scripts\activate     # Windows
    ```

3. Установите зависимости:

    ```bash
    pip install -r requirements.txt
    ```

## Конфигурация

В корневой директории проекта создайте файл `.env`. В нем должны быть определены следующие переменные:

```ini
BOT_TOKEN=123456789:AABBCC...
CHAT_ID=123456789
FILE_PATH=data.txt
```

* **BOT_TOKEN**: Токен вашего бота, полученный у @BotFather.
* **CHAT_ID**: ID чата или пользователя, куда будут отправляться сообщения.
* **FILE_PATH**: Путь к файлу, который необходимо отправить.

## Запуск

Убедитесь, что файл с данными существует, затем выполните команду:

```bash
python file_sender.py
```

## Важные нюансы

1. **Лимит размера файла (50 МБ):**
    Скрипт выполняет проверку размера файла (`os.path.getsize`) **до** начала чтения. Файлы размером более 50 МБ игнорируются. Это жесткое ограничение Telegram API для ботов, а также мера защиты от `MemoryError` при попытке загрузить огромный файл в оперативную память.

2. **Кодировка файла:**
    Скрипт использует библиотеку `chardet` для анализа содержимого. Если вероятность определения кодировки низка или кодировка не поддерживается, файл будет пропущен с записью ошибки в лог.

3. **Безопасность:**
    Файл `.env` содержит секретные ключи. Добавьте его в `.gitignore` и не передавайте третьим лицам.

4. **Разметка:**
    В текущей реализации параметр `parse_mode` установлен в `None`. HTML или Markdown теги в исходном файле будут отображаться как обычный текст, чтобы избежать ошибок парсинга при автоматической разбивке сообщений.
